import { useEffect, useState, useContext } from "react";
import { db } from "../../firebaseConfig";
import { collection, query, where, getDocs } from "firebase/firestore";
import { AuthContext } from "../../context/AuthContext";

export function Series() {
  const [movies, setMovies] = useState([]);
  const { currentUser } = useContext(AuthContext);

  useEffect(() => {
    if (currentUser) {
      const moviesCollectionRef = collection(db, "movies");
      const q = query(
        moviesCollectionRef,
        where("userId", "==", currentUser.uid)
      );

      const getMovies = async () => {
        try {
          const querySnapshot = await getDocs(q);
          const moviesList = querySnapshot.docs.map((doc) => ({
            id: doc.id,
            ...doc.data(),
          }));
          setMovies(moviesList);
        } catch (error) {
          console.error("Error al obtener las películas:", error);
        }
      };

      getMovies();
    }
  }, [currentUser]);

  return (
    <>
      <h1>Series</h1>
      <div>
        {movies.length > 0 ? (
          movies.map((movie) => (
            <div key={movie.id}>
              <p>{movie.title}</p>
            </div>
          ))
        ) : (
          <p>No hay películas para mostrar.</p>
        )}
      </div>
    </>
  );
}
